<!DOCTYPE html>
<html>
<head>
  <title>ShopFlow Production Board</title>
  <style>
    body { font-family: Arial; margin: 0; background: #f2f2f2; }
    .col { flex: 1; margin: 10px; background: white; border-radius: 6px; padding: 10px; }
    .card { background: #eee; padding: 10px; margin: 10px 0; border-radius: 4px; }
    h2 { text-align: center }
    .board { display: flex; height: 100vh; }
  </style>
</head>

<body>
  <div class="board" id="board"></div>

<script>
const columns = [
  "Waiting for Diag",
  "In Process",
  "Waiting on Approval",
  "Waiting on Parts",
  "Sublet",
  "Finished/Pick Up"
];

async function load() {
  const res = await fetch("/api/ro/all");
  const json = await res.json();
  const data = json.repairs;

  const board = document.getElementById("board");
  board.innerHTML = "";

  columns.forEach(col => {
    const div = document.createElement("div");
    div.className = "col";
    div.innerHTML = `<h2>${col}</h2>`;

    data.filter(r => r.status === col).forEach(r => {
      div.innerHTML += `
        <div class="card">
          <strong>RO: ${r.ro}</strong><br>
          ${r.customer}<br>
          ${r.vehicle}<br>
          Tech: ${r.tech}
        </div>`;
    });

    board.appendChild(div);
  });
}

load();
const ws = new WebSocket(`wss://${location.host}/ws`);
ws.onmessage = () => load();
</script>
</body>
</html>
